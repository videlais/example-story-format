window.storyFormat({"name":"Example","version":"0.0.2","source":"<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\t\t<meta charset=\"utf-8\">\n\t\t<title>{{STORY_NAME}}</title>\n\t</head>\n\t<body>\n\t\t{{STORY_DATA}}\n\t\t<script>\n      (function(window){\n\n              // Add an 'example' global property\n              window.example = {};\n\n              // Extend the window.example with a parse()\n              // Parse the text\n              // - Change any &lt; to <\n              // - Change any &gt; to >\n              // - Run any <script>\n              // - Include any passages using <include>\n              // - Convert string emphasis\n              // - Convert emphasis\n              // - Create hyperlinks (and add event listeners)\n              window.example.parse = function parse(result) {\n\n                  // Look for &lt;\n                  // If found, convert into '<'\n                  result = result.replace(/&lt;/g, function (match, target) {\n\n                      return \"<\";\n\n                  });\n\n                  // Look for &gt;\n                  // If found, convert into '>'\n                  result = result.replace(/&gt;/g, function (match, target) {\n\n                      return \">\";\n\n                  });\n\n                  // Using innerHTML will not run any SCRIPT tags.\n                  // Look for SCRIPT tags\n                  // If found, run eval(text)\n                  result = result.replace(/<script>((?:.|\\n)*?)<\\/script>/g, function(match, target) {\n                      // Run the code\n                      eval(target);\n                      // Return an empty string\n                      return \"\";\n                  });\n\n                  // Look for <include> elements\n                  // If found, find the passage, parse it, and return its contents\n                  result = result.replace(/<include>(.*?)<\\/include>/g, function(match, target) {\n\n                      // Look for the passage by its name\n                      let passage = example.findPassageByName(target);\n\n                      // Save a result\n                      let result = \"\";\n\n                      // Was it found?\n                      if(passage !== null) {\n                          // If so, parse it and save the result\n                          result = example.parse(passage.innerHTML)\n\n                      }\n\n                      // Return result.\n                      // It will either be an empty string or the parsed content.\n                      return result;\n                  });\n\n\n                  // Look for any text in the pattern of __text__.\n                  // If found, replace with <em>text</em>\n                  result = result.replace(/\\_\\_(.*?)\\_\\_/g, function (match, target) {\n\n                      return `<em>${target}</em>`;\n\n                  });\n\n                  // Look for any text in the pattern of **text**.\n                  // If found, replace with <strong>text</strong>\n                  result = result.replace(/\\*\\*(.*?)\\*\\*/g, function (match, target) {\n\n                      return `<strong>${target}</strong>`;\n\n                  });\n\n                  /* Classic [[links]]  */\n                  result = result.replace(/\\[\\[(.*?)\\]\\]/g, function (match, target) {\n                      var display = target;\n\n                      /* display|target format */\n                      var barIndex = target.indexOf('|');\n\n                      if (barIndex !== -1) {\n\n                          display = target.substr(0, barIndex);\n                          target = target.substr(barIndex + 1);\n\n                      } else {\n                          /* display->target format */\n                          var rightArrIndex = target.indexOf('->');\n\n                          if (rightArrIndex !== -1) {\n\n                              display = target.substr(0, rightArrIndex);\n                              target = target.substr(rightArrIndex + 2);\n\n                          } else {\n\n                              /* target<-display format */\n                              var leftArrIndex = target.indexOf('<-');\n\n                              if (leftArrIndex !== -1) {\n                                  display = target.substr(leftArrIndex + 2);\n                                  target = target.substr(0, leftArrIndex);\n                              }\n                          }\n                      }\n\n                      return '<a href=\"javascript:void(0)\" data-passage=\"' +\n                             target + '\">' + display + '</a>';\n\n                  });\n\n                  return result;\n\n              }\n\n              window.example.findPassageByPid = function findPassageByPid(pid) {\n                  // Find the element by its 'pid'\n                  return document.querySelector(`[pid=\"${pid}\"]`);\n              }\n\n              window.example.findPassageByName = function findPassageByName(name) {\n                  // Find the element by its 'name'\n                  return document.querySelector(`[name=\"${name}\"]`);\n              }\n\n              window.example.showPassage = function showPassage(passagedata) {\n\n                  // Look for the 'tw-passage'\n                  let passage = document.querySelector('tw-passage');\n\n                  // If it is null, it does not exist yet\n                  if(passage === null) {\n                      // Create it\n                      passage = document.createElement('tw-passage');\n                  }\n\n                  // Save the passage contents\n                  let passageContents = passagedata.innerHTML;\n\n                  // Parse contents\n                  passageContents = example.parse(passageContents);\n\n                  // Set the 'innerHTML' to parsed text\n                  passage.innerHTML = passageContents;\n\n                  // Find all links in the current passage\n                  let links = passage.querySelectorAll('a[data-passage]');\n\n                  // For each link, add an event listener\n                  for(let link of links) {\n                      // If a link is clicked...\n                      link.addEventListener('click', function() {\n                          // Get the name of the passage to load.\n                          let passagename = this.attributes[\"data-passage\"].value;\n                          // Find the passage by its name\n                          let passagedata = example.findPassageByName(passagename);\n                          // Show the passage\n                          example.showPassage(passagedata);\n                      });\n                  }\n\n                  // Append the child element to the HTML <body>\n                  // (If it already exists, it will not be appended.)\n                  document.body.appendChild(passage);\n\n              }\n\n              // Find the 'tw-storydata' element.\n              let storydata = document.querySelector('tw-storydata');\n\n              // Get the 'startnode' attribute. Save its 'value'.\n              let startnode = storydata.attributes['startnode'].value;\n\n              // Find the element with a 'pid' of the startnode\n              let passagedata = window.example.findPassageByPid(startnode);\n\n              // Show the passage matching the startnode\n              example.showPassage(passagedata);\n\n          }(window))\n\t\t</script>\n\t</body>\n</html>\n","description":"An example story format"});